machine:
  services:
    - docker

checkout:
  post:
    - wget http://selenium-release.storage.googleapis.com/2.45/selenium-server-standalone-2.45.0.jar -O selenium-server-standalone.jar

dependencies:
  override:
    - touch deploy/id_rsa.pub
    - make build
    - make run
    # Let mysql spin up
    - sleep 3

test:
  pre:
    # Run selenium server in background: https://circleci.com/docs/background-process
    - 'java -jar selenium-server-standalone.jar &> artifacts/selenium.log':
        background: true
  override:
    - curl -v localhost:8080
    - curl -s localhost:8080 | grep RSVP
    - make ssh SSH_CMD="'cd /var/www/tests && vendor/bin/behat'"
